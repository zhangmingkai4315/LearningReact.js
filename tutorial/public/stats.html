<html>
<head>
    <title>Hello React</title>
    <script src="../../bower_components/react/react.js"></script>
    <script src="../../bower_components/react/JSXTransformer.js"></script>
    <script src="../../bower_components/jquery/dist/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
</head>
<body>
<div id="content"></div>
<script>
</script>




<script type="text/jsx">

    var CommentBox=React.createClass({
        getInitialState: function () {
            return {data:[]};
        },
        componentDidMount: function () {
            $.ajax({
                url:this.props.url,
                dataType:'json',
                cache:false,
                success: function (data) {
                    this.setState({data:data});
                }.bind(this),
                error: function (xhr,status,err) {
                    console.error(this.props.url,status,err.toString())
                }.bind(this)
            });
        },
        render: function () {
            return (<div class="commentBox">Hello world! I am a comment box
                <CommentList data={this.state.data}/><CommentForm/>
            </div>);
        }
    });

    var CommentList=React.createClass({

        render:function(){
            var commentNodes=this.props.data.map(function (comment) {
                return (<Comment author={comment.author}>
                {comment.text}
                </Comment>);
            });
            return(<div class="commentList">
                {commentNodes}
            </div> )
        }
    });
    var CommentForm=React.createClass({
        render:function(){
            return(<div class="commentForm">Hello world,I am a commentForm</div> )
        }
    });


    var Comment=React.createClass({
        render: function () {

            var rawMarkup = marked(this.props.children.toString(), {sanitize: true});
            return(<div className="comment">
                <h2 className="commentAuthor">
                    {this.props.author}
                </h2>
                <span dangerouslySetInnerHTML={{__html: rawMarkup}} />
            </div>)
        }
    })

    React.render(<CommentBox data={data}/>,document.getElementById('content'));
</script>
</body>
</html>